# define the following variables:
# connection
# subscriptionId
# environmentName
# location
# azureClientId
# azureClientSecret

name: Deploy Bicep files

trigger:
- v9

pool:
  vmImage: ubuntu-latest

steps:
- task: AzureResourceManagerTemplateDeployment@3
  inputs:
    deploymentScope: 'Subscription'
    azureResourceManagerConnection: '$(connection)'
    subscriptionId: '$(subscriptionId)'
    location: '$(location)'
    templateLocation: 'Linked artifact'
    csmFile: './infrastructure/azure/main.bicep'
    csmParametersFile: './infrastructure/azure/main.parameters.json'
    overrideParameters: '-environmentName $(environmentName) -location $(location) -azureClientId $(azureClientId) -azureClientSecret $(azureClientSecret)'
    deploymentMode: 'Incremental'    